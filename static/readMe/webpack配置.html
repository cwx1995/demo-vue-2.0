<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>webpack配置</title>
    <style>
        .title {
            color: red;
            font-weight: bold;
        }

        h4 {
            font-weight: normal;
        }
    </style>
</head>
<body>
    
</body>
</html>

<script type="text/javaScript">
  *webpack配置
  entry 入口配置项
  output 输出配置项
  loader 处理文件的loader 1下载2使用 module:{rules:[{...具体配置},{...具体配置}]} 多个loader执行为倒序执行
  plugins 插件 用于执行更广的任务 1下载2引入3使用  new xxx({...配置项})
  mode  模式  生产还是开发

  * dev配置  见js

  *css兼容性处理
    使用postcss =》 下载 postcss-loader  postcss-preset-env

    module:{
        rules:[
            {
                test:/\.css$/,
                use:[
                    'MiniCssExtractPlugin.loader',
                    'css-loader',
                    //'postcss-loader' //使用默认配置
                    {  //自定义配置
                        loader:'postcss-loader',
                        options:{
                            ident:'postcss',
                            plugins:()=>[require('postcss-preset-env')()]
                        }
                    }
                ]
                
            }
        ]
    }

    package.json:
   //配置开发，上传环境下兼容的版本
    "browserslist":[
        "development":["last 1 chrome version","last 1 firefox version"],
        "production":[">0.2%","not dead","not op_mini all"]
    ]

  *js语法检查
   eslint检查 => eslint eslint-loader 安装
   airbnb格式规范 => eslint-config-airbnb-base eslint-plugin-import 安装

   module:{
       rules:[
           {
           test:/\.js$/,
           exclude:/node-modules/, //不检查第三方库
           loader:'eslint-loader',
           options:{
               fix:true  //自动修复
           }
        }
       ]
   }

   package.json:
   //eslint配置规则为airbnb
   "eslintConfig":{
       "extends":"airbnb-base"
   }

   //eslint-disable-nest-line   忽略下一行校验

   *js兼容性处理

   babel-loader @babel/core 安装

   1.一般性处理 使用@babel/preset-env库  
   *只能转换基本语法  不能转换promise等*
   module:{
       rules:[
           {
            loader:'babel-loader',
            exclude:/node-modules/,
            options:{
                presets:['@babel/preset-env'] //预设 指示babel做怎样的兼容性处理
            }
           }
       ]
   }

   2.全部的js兼容处理 包括promise等语法兼容 @babel/polyfill 库
   *所有兼容性代码引入 体积较大*
   在js文件中引入： import '@babel/polyfill'

   3.按需兼容性处理 core-js  无需js引入@babel/polyfill
   module:{
       rules:[
           {
            exclude:/node-modules/,
            loader:'babel-loader',
            options:{
                preset:[
                    [
                        '@babel/preset-env',
                        {
                         useBuildIns:'usage', //按需加载
                         corejs:{
                             version:3  //指定core-js版本
                         },
                            targets:{  //指定兼容浏览器版本
                                chrome:'60',
                                firebox:'50',
                                ie:'9'
                            }
                        }
                    ]   
                ]
            }
           }
       ]
   }

   *压缩css
   optimize-css-assets-webpack-plugin 下载

    const OptimizeCssAssetsWebpackPlugin=require('optimize-css-assets-webpack-plugin')

    plugins:[
        new OptimizeCssAssetsWebpackPlugin()
    ]

    *js压缩
    mode:'production'  //生产环境自动压缩

    *html压缩
    html-webpack-plugin 下载
    const HtmlWebpackPlugin=require('html-webpack-plugin')
    plugins:[
        new HtmlWebpackPlugin({
            template:'./src/index.html',//指定文件路径
            minify:{
                collapseWhitespace:true,//去空格
                removeComments:true//移除注释
            }
        })
    ]

    *生产配置总结 见js 

    *优化 HMR
    hot module replacement  热模块替换/更新
    只重新打包修改的模块 不打包所有 限开发模式使用
    css默认具有HMR html则不需要HMR
    mode:'devlopment',
    devServer:{
        contentBase:resolve(__dirname,'build'),//打包输出目录
        compress:true,//gzip压缩
        port:3000,//端口
        open:true,//开启浏览器自动
        hot:true //热更新
    }
    js默认无HMR  需在js中配置
    if(module.hot){
        //监听./test.js变化
        module.hot.accept('./test.js',function() {
            ...回调 
        })
    }

    source-map: 提供源代码到构建后代码的映射

    构建后代码出错 可以看到错在哪里

    [inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map

    source-map: 外联 提示错误位置 可以查看详细源代码
    inline-source-map: 内联 只生成一个source-map 可以查看详细源代码
    hidden-source-map: 外联 只提示错误 无法查看源代码
    eval-source-map: 内联 每个文件都生成source-map 提示源代码错误位置 有hash值  可以查看详细源代码
    nosources-source-map: 外联 提示原因 但无法查看源代码
    cheap-source-map:外联 提示源代码一整行报错信息
    cheap-module-source-map:外联 

    内联外联: 是否外部生成map文件  内联较快  
    开发：eval-source-map  / eval-cheap-module-source-map
    生产：source-map / cheap-module-source-map

</script>